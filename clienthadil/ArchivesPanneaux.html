<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Liste_des_panneaux</title>
  <meta content="" name="description">
  <meta content="" name="keywords">
  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  <!-- Custom CSS -->
  <style>
    .img-fluid {
      max-width: 100px; /* Réglez la taille maximale de l'image ici */
    }
  </style>
</head>

<body>

  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Archive des Panneaux</h3>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped" id="archivespanneauxTable">

                       <!-- code de telechargement pdf ou exel -->
        <div class="col-12 text-end mb-3">
          <i id="download-pdf" class="bi bi-file-earmark-pdf btn-icon" style="font-size: 2em; color: red; cursor: pointer;"></i>
          <i id="download-excel" class="bi bi-file-earmark-excel btn-icon" style="font-size: 2em; color: green; cursor: pointer;"></i>
        </div>
        
        <style>
          .btn-icon {
            margin-right: 15px;
          }
        </style>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#Ajouter">
                  <i class="bi bi-plus"></i> Ajouter
                </button>
                
                <div class="modal fade" id="Ajouter" tabindex="-1">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                      </div>
                      <div class="modal-body">
                        <form id="ajouterForm">
                          <div>
                            <label for="code Face" class="form-label">Code Face:</label>
                            <input type="text" id="code_face" class="form-control" name="code_face" required />
                          </div>
                          <div>
                            <label for="région" class="form-label">Région:</label>
                            <input type="text" id="region" class="form-control" name="region" required />
                          </div>
                          <div>
                            <label for="emplacement" class="form-label">Emplacement:</label>
                            <input type="text" id="emplacement" class="form-control" name="emplacement" required />
                          </div>
                          <div>
                            <label for="type" class="form-label">Type:</label>
                            <input type="text" id="type" class="form-control" name="type" required />
                          </div>
                          <div>
                            <label for="prix" class="form-label">Prix:</label>
                            <input type="text" id="prix" class="form-control" name="prix" required />
                          </div>
                          <div>
                            <label for="trafic routier" class="form-label">Trafic Routier:</label>
                            <input type="text" id="trafic_routier" class="form-control" name="trafic_routier" required />
                          </div>
                          <div>
                            <label for="photo" class="form-label">Photo:</label>
                            <input type="text" id="photo" class="form-control" name="photo" required />
                          </div>
                          
                        </form>
                      </div>
                      <div class="modal-footer">
                        <button type="button" id="submitButton" class="btn btn-success"><i class="bi bi-plus"></i>Ajouter</button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal"><i class="bi bi-x"></i>Annuler</button>
                      
                      </div>
                    </div>
                  </div>
                </div>
                &nbsp;&nbsp;
  
                <!-- Bouton pour ouvrir la fenêtre modale -->
                <button type="button" class="btn btn-warning" onclick="openModifierModal()">
                  <i class="bi bi-pencil"></i> Modifier
                </button>
                
                <!-- Fenêtre modale -->
                <div class="modal fade" id="modifierModal" tabindex="-1">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title">Modifier</h5>
                        <button type="button" class="btn-close" aria-label="Fermer" onclick="closeModifierModal()"></button>
                      </div>
                      <div class="modal-body">
                        <form id="modificationForm">
                          <div class="mb-3">
                            <label for="code_face_input" class="form-label">Code Face</label>
                            <input type="text" class="form-control" id="code_face_input" name="code_face">
                          </div>
                          <div class="mb-3">
                            <label for="region_input" class="form-label">Region</label>
                            <input type="text" class="form-control" id="region_input" name="region">
                          </div>
                          <div class="mb-3">
                            <label for="emplacement_input" class="form-label">Emplacement</label>
                            <input type="text" class="form-control" id="emplacement_input" name="emplacement">
                          </div>
                          <div class="mb-3">
                            <label for="type_input" class="form-label">Type</label>
                            <input type="text" class="form-control" id="type_input" name="type">
                          </div>
                          <div class="mb-3">
                            <label for="prix_input" class="form-label">Prix</label>
                            <input type="text" class="form-control" id="prix_input" name="prix">
                          </div>
                          <div class="mb-3">
                            <label for="trafic_routier_input" class="form-label">Trafic Routier</label>
                            <input type="text" class="form-control" id="trafic_routier_input" name="traficRoutier">
                          </div>
                          <div class="mb-3">
                            <label for="photo_input" class="form-label">Photo</label>
                            <input type="text" class="form-control" id="photo_input" name="photo">
                          </div>
                        </form>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-success" onclick="confirmModification()">
                          <i class="bi bi-check-circle"></i> Confirmer
                        </button>
                        <button type="button" class="btn btn-danger" onclick="closeModifierModal()">
                          <i class="bi bi-x"></i> Annuler
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                
                <script>
                  var IDArchivespanneaux; // Global variable to store the selected ID
                
                  function openModifierModal() {
                    // Check if a checkbox is checked
                    var checkboxChecked = $("#archivespanneauxTable tbody input[name='archivespanneaux']:checked").length > 0;
                
                    if (checkboxChecked) {
                      $("#archivespanneauxTable tbody input[name='archivespanneaux']:checked").each(function() {
                        IDArchivespanneaux = $(this).val();
                      });
                
                      // Retrieve the form values from the selected row
                      var selectedRow = $("#archivespanneauxTable tbody input[name='archivespanneaux']:checked").closest('tr');
                
                      var codeFace = selectedRow.find('td:eq(1)').text().trim();
                      var region = selectedRow.find('td:eq(2)').text().trim();
                      var emplacement = selectedRow.find('td:eq(3)').text().trim();
                      var type = selectedRow.find('td:eq(4)').text().trim();
                      var prix = selectedRow.find('td:eq(5)').text().trim();
                      var traficRoutier = selectedRow.find('td:eq(6)').text().trim();
                      var photo = selectedRow.find('td:eq(7) img').attr('src');
                
                      // Pre-fill the form fields in the modification modal
                      $('#code_face_input').val(codeFace);
                      $('#region_input').val(region);
                      $('#emplacement_input').val(emplacement);
                      $('#type_input').val(type);
                      $('#prix_input').val(prix);
                      $('#trafic_routier_input').val(traficRoutier);
                      $('#photo_input').val(photo);
                
                      // Show the modification modal
                      $('#modifierModal').modal('show');
                    } else {
                      // If no checkbox is checked, show an error message
                      alert("Veuillez cocher au moins une case avant de modifier.");
                    }
                  }
                
                  function closeModifierModal() {
                    $('#modifierModal').modal('hide');
                  }
                
                  async function confirmModification() {
                    const formElement = document.getElementById('modificationForm');
                    const formData = new FormData(formElement);
                    const formObject = {};
                
                    // Convert FormData to plain object
                    formData.forEach((value, key) => {
                      formObject[key] = value;
                    });
                
                    try {
                      console.log('<--------------------->');
                      console.log(formObject);
                      console.log('<--------------------->');
                
                      const response = await fetch('http://localhost:3001/archivespanneaux/' + IDArchivespanneaux, {
                        method: 'PUT',
                        headers: {
                          'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formObject)
                      });
                
                      if (response.ok) {
                        const data = await response.json();
                        console.log('Modification réussie', data);
                        window.location.href = 'ArchivesPanneaux.html';
                      } else {
                        console.error('Échec de la modification:', response.statusText);
                      }
                    } catch (error) {
                      console.error('Erreur lors de la modification:', error);
                    }
                
                    closeModifierModal();
                  }
                </script>
                
                
                

                



                

                
                &nbsp;&nbsp;
  
            <!-- code  de la confirmation de suppression -->
<button type="button" class="btn btn-danger" data-bs-target="#confirmDeleteModal"  onclick="deleteAction()">
  <i class="bi bi-trash"></i> Supprimer
  </button>
  <!-- Fenêtre de confirmation de suppression -->
  <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLabel">Confirmation de suppression</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body">
      Êtes-vous sûr de vouloir supprimer les lignes sélectionnées ?
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
      <button type="button" class="btn btn-danger" onclick="confirmDelete()">Supprimer</button>
    </div>
  </div>
  </div>
  </div>
        
           <!-- Button pour ouvrir la fenêtre de confirmation de suppression -->
            
  
            </div>
          </div>
        </div>
  
      </div>
    </div>
</section> 
           <!-- Button pour ouvrir la fenêtre de confirmation de suppression -->
           <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
           <script>
            var deletedIDArchivespanneau; // Global variable to store the selected ID
            
            function deleteAction() {
              // Check if at least one checkbox is checked
              var checkedItems = $("#archivespanneauxTable tbody input[name='archivespanneaux']:checked");
            
              if (checkedItems.length > 0) {
                // Store the ID of the checked item
                deletedIDArchivespanneau = checkedItems.val();
                
                // Show the delete confirmation modal
                $('#confirmDeleteModal').modal('show');
              } else {
                alert("Veuillez cocher au moins une case avant de supprimer.");
              }
            }
            
            // Function to confirm deletion
            function confirmDelete() {
              if (!deletedIDArchivespanneau) {
                alert("Aucune ID sélectionnée pour la suppression.");
                return;
              }
            
              // Send an AJAX request to delete the item by ID
              $.ajax({
                url: 'http://localhost:3001/archivespanneaux/' + deletedIDArchivespanneau,
                type: 'DELETE',
                success: function(response) {
                  // Handle success
                  console.log("Deletion successful", response);
            
                  // Remove the corresponding row from the table
                  $("#archivespanneauxTable tbody input[name='archivespanneaux']:checked").closest('tr').remove();
            
                  // Hide the modal
                  $('#confirmDeleteModal').modal('hide');
                },
                error: function(error) {
                  // Handle error
                  console.log("Deletion failed", error);
                }
              });
            }
            </script>

           <br> <br>
                <thead>
                  <tr>
                    <th></th>
                    
                    <th scope="col">Code face</th>
                    <th scope="col">Region</th>
                    <th scope="col">Emplacement</th>
                    <th scope="col">Type</th>
                    <th scope="col">Prix</th>
                    <th scope="col">Trafic Routier</th>
                    <th scope="col">Photo</th>
                    <th scope="col">Date de création</th>
                    
                  </tr>
                </thead>
                <tbody>
                
                  <!-- Add more rows as needed -->
                </tbody>
              </table>

             
               <!-- code  de la confirmation Ajouter -->
 


            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer mt-5 py-3">
    <div class="copyright">
      <strong><span>Tableau De Bord</span>   <div class="social-links mt-2">
        <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
        <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
        <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
        <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
      </div></strong>
    </div>
  </footer>
  <!-- End Footer -->

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

</body>
<script>
  // Fetch data mta3 el panneaux from the server
  async function fetchData() {
      try {
          const response = await fetch('http://localhost:3001/archivespanneaux/');
          const data = await response.json();
          return data;
      } catch (error) {
          console.error('Error fetching data:', error);
          throw error; // bech n tcheki si famma erreur
      }
  }

  // Populate the table with fetched data
  async function populateTable() {
      try {
          const data = await fetchData();
          const tableBody = document.querySelector('#archivespanneauxTable tbody');

          data.forEach(function (archivespanneau) {
              var row = document.createElement('tr');
              row.innerHTML = `
              <td><input type="radio" name="archivespanneaux" value="${archivespanneau._id}"></td>
                  <td><a href="#" class="text-primary fw-bold">${archivespanneau.code_face}</a></td>
                  <td>${archivespanneau.region}</td>
                  <td>${archivespanneau.emplacement}</td>
                  <td>${archivespanneau.type}</td>
                  <td>${archivespanneau.prix}</td>
                  <td>${archivespanneau.trafic_routier}</td>
                  <td><img src="${archivespanneau.photo}" style="max-width: 100px; max-height: 100px;"></td>
                  <td>${archivespanneau.cree_a}</td>
              `;
              tableBody.appendChild(row);
          });
      } catch (error) {
          console.error('Error populating table:', error);
      }
  }

  populateTable(); // nedi el function  populateTable() awel ma tet7al el page automatique
  </script>

   <!-- fonction ajouter -->
<script>
  document.getElementById('submitButton').addEventListener('click', async function(event) {
    event.preventDefault(); // Prevent the default button behavior
  
    const formData = new FormData(document.getElementById('ajouterForm')); // Create a FormData object from the form
    for (let pair of formData.entries()) {
      console.log(pair[0] + ': ' + pair[1]);
    }
    try {
      const response = await fetch('http://localhost:3001/archivespanneaux/', {
        method: 'POST',
        body: formData
      });
      
      if (response.ok) {
        const data = await response.json();
        console.log('Panneau added successfully:', data);
        window.location.href = 'ArchivesPanneaux.html';
      } else {
        console.error('Failed to add ArchivesPanneauxprix:', response.statusText);
      }
    } catch (error) {
      console.error('Error adding ArchivesPanneaux:', error);
    }
  });
    
    
    </script>

<!-- TELECHARGEMENT -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>


<script>
  document.getElementById('download-pdf').addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const table = document.getElementById('archivespanneauxTable');
    const rows = Array.from(table.rows).map(row => Array.from(row.cells).map(cell => cell.innerText));

    const headers = rows.shift(); // Remove the first row for headers
    const data = rows;

    doc.autoTable({
      head: [headers],
      body: data,
    });

    doc.save('archivespanneaux.pdf');
  });
</script>

<script>
  document.getElementById('download-excel').addEventListener('click', () => {
    const table = document.getElementById('archivespanneauxTable');
    const wb = XLSX.utils.table_to_book(table, {sheet: "archivespanneaux"});

    XLSX.writeFile(wb, 'archivespanneaux.xlsx');
  });
</script>

</html>