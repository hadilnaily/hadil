<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Archives compagnes</title>
  <meta content="" name="description">
  <meta content="" name="keywords">
  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
  <!-- Custom CSS -->
  <style>
    .img-fluid {
      max-width: 100px; /* Réglez la taille maximale de l'image ici */
    }
  </style>
</head>

<body>
              
                <div class="container mt-5">
                  <div class="row justify-content-center">
                    <div class="col-12">
                      <div class="card">
                        <div class="card-header">
                          <h3 class="card-title">Archive des compagnes</h3>
                        </div>
                        <div class="card-body">
                          <div class="table-responsive">
                            <table class="table table-striped" id="archivescompagnesTable">

                                     <!-- code de telechargement pdf ou exel -->
        <div class="col-12 text-end mb-3">
          <i id="download-pdf" class="bi bi-file-earmark-pdf btn-icon" style="font-size: 2em; color: red; cursor: pointer;"></i>
          <i id="download-excel" class="bi bi-file-earmark-excel btn-icon" style="font-size: 2em; color: green; cursor: pointer;"></i>
        </div>
        
        <style>
          .btn-icon {
            margin-right: 15px;
          }
        </style>



                              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                             <!-- code  de la confirmation Ajouter -->
               <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#Ajouter">
                <i class="bi bi-plus"></i> Ajouter
              </button>
              <div class="modal fade" id="Ajouter" tabindex="-1">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                    </div>
                    <div class="modal-body">
                      <form id="ajouterForm">
                        
                        <div class="mb-3">
                          <label for="nom-annonceur" class="form-label">Nom Annonceur:</label>
                          <input type="text" id="nom_annanceur" class="form-control" name="nom_annanceur" required />
                        </div>
                        <div class="mb-3">
                          <label for="media-vusiel" class="form-label">Média Vusiel:</label>
                          <input type="text" id="media_vusiel" class="form-control" name="media_vusiel" required />
                        </div>
                        
                        <div class="mb-3">
                          <label for="date-publication" class="form-label">Date Publication:</label>
                          <input type="date" id="date_publication" class="form-control" name="date_publication" required />
                        </div>
                        <div class="mb-3">
                          <label for="date-retrait" class="form-label">Date Retrait:</label>
                          <input type="date" id="date_retrait" class="form-control" name="date_retrait" required />
                        </div>
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" id="submitButton" class="btn btn-success"><i class="bi bi-plus"></i>Ajouter</button>
                      <button type="button" class="btn btn-danger" data-bs-dismiss="modal"><i class="bi bi-x"></i>Annuler</button>
                      
                    </div>
                  </div>
                </div>
              </div>
              &nbsp;&nbsp;

          <!-- Bouton pour ouvrir la fenêtre modale -->
<!-- Bouton pour ouvrir la fenêtre de confirmation de modification -->
<button type="button" class="btn btn-warning" onclick="openModifierModal()">
  <i class="bi bi-pencil"></i> Modifier
</button>

<!-- Fenêtre modale -->
<div class="modal fade" id="Modifier" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirmation de Modification</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>
      <div class="modal-body">
        <form id="modificationForm">
          <div class="mb-3">
            <label for="nom_annanceur_input" class="form-label">Nom Annanceur</label>
            <input type="text" class="form-control" id="nom_annanceur_input" name="nom_annanceur">
          </div>
          <div class="mb-3">
            <label for="media_vusiel_input" class="form-label">Média Vusiel</label>
            <input type="text" class="form-control" id="media_vusiel_input" name="media_vusiel">
          </div>
          <div class="mb-3">
            <label for="date_publication_input" class="form-label">Date Publication</label>
            <input type="text" class="form-control" id="date_publication_input" name="date_publication">
          </div>
          <div class="mb-3">
            <label for="date_retrait_input" class="form-label">Date Retrait</label>
            <input type="text" class="form-control" id="date_retrait_input" name="date_retrait">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" onclick="confirmModification()">
          <i class="bi bi-check-circle"></i> Confirmer
        </button>
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Fermer</button>
      </div>
    </div>
  </div>
</div>
<!-- code  de la modification -->
<script>
var IDArchivescompagnes;
function openModifierModal() {
  var checkboxChecked = $("#archivescompagnesTable tbody input[name='archivescompagnes']:checked").length > 0;

  if (checkboxChecked) {
    if ($("#archivescompagnesTable tbody input[name='archivescompagnes']:checked").length > 1) {
      alert("Veuillez cocher une seule case à la fois pour modifier.");
      return;
    }

    $("#archivescompagnesTable tbody input[name='archivescompagnes']:checked").each(function(){
      IDArchivescompagnes = $(this).val();
    });

    var selectedRow = $("#archivescompagnesTable tbody input[name='archivescompagnes']:checked").closest('tr');
    var nomAnnanceur = selectedRow.find('td:eq(1)').text().trim();
    var mediaVusiel = selectedRow.find('td:eq(2) img').attr('src');
    var datePublication = selectedRow.find('td:eq(3)').text().trim();
    var dateRetrait = selectedRow.find('td:eq(4)').text().trim();

    // Affecter les valeurs aux champs du formulaire
    $('#nom_annanceur_input').val(nomAnnanceur);
    $('#media_vusiel_input').val(mediaVusiel);
    $('#date_publication_input').val(datePublication);
    $('#date_retrait_input').val(dateRetrait);
    $('#Modifier').modal('show');
  } else {
    alert("Veuillez cocher au moins une case avant de modifier.");
  }
}

async function confirmModification() {
  const formElement = document.getElementById('modificationForm');
  const formData = new FormData(formElement);
  const formObject = {};

  // Convertir FormData en objet simple
  formData.forEach((value, key) => {
    formObject[key] = value;
  });

  try {
    console.log('<--------------------->');
    console.log('IDArchivescompagnes:', IDArchivescompagnes);
    console.log('Form Data:', formObject);
    console.log('<--------------------->');

    const response = await fetch('http://localhost:3001/archivescompagnes/' + IDArchivescompagnes, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(formObject)
    });

    if (response.ok) {
      const data = await response.json();
      console.log('Modification réussie', data);
      window.location.href = 'ArchivesCompagnes.html';
    } else {
      console.error('Échec de la modification:', response.statusText);
      alert('Échec de la modification: ' + response.statusText);
    }
  } catch (error) {
    console.error('Erreur lors de la modification:', error);
    alert('Erreur lors de la modification: ' + error.message);
  }

  $('#Modifier').modal('hide');
}
</script>


              
              &nbsp;&nbsp;


                <!-- code  de la confirmation de suppression -->
<button type="button" class="btn btn-danger" data-bs-target="#confirmDeleteModal"  onclick="deleteAction()">
  <i class="bi bi-trash"></i> Supprimer
  </button>
  <!-- Fenêtre de confirmation de suppression -->
  <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLabel">Confirmation de suppression</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body">
      Êtes-vous sûr de vouloir supprimer les lignes sélectionnées ?
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
      <button type="button" class="btn btn-danger" onclick="confirmDelete()">Supprimer</button>
    </div>
  </div>
  </div>
  </div>
        
           <!-- Button pour ouvrir la fenêtre de confirmation de suppression -->
            
  
            </div>
          </div>
        </div>
  
      </div>
    </div>
</section> 
           <!-- Button pour ouvrir la fenêtre de confirmation de suppression -->
           <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
           <script>
            var deletedIDArchivescompagne; // Global variable to store the selected ID
            
            function deleteAction() {
              // Check if at least one checkbox is checked
              var checkedItems = $("#archivescompagnesTable tbody input[name='archivescompagnes']:checked");
            
              if (checkedItems.length > 0) {
                // Store the ID of the checked item
                deletedIDArchivescompagne = checkedItems.val();
                
                // Show the delete confirmation modal
                $('#confirmDeleteModal').modal('show');
              } else {
                alert("Veuillez cocher au moins une case avant de supprimer.");
              }
            }
            
            // Function to confirm deletion
            function confirmDelete() {
              if (!deletedIDArchivescompagne) {
                alert("Aucune ID sélectionnée pour la suppression.");
                return;
              }
            
              // Send an AJAX request to delete the item by ID
              $.ajax({
                url: 'http://localhost:3001/archivescompagnes/' + deletedIDArchivescompagne,
                type: 'DELETE',
                success: function(response) {
                  // Handle success
                  console.log("Deletion successful", response);
            
                  // Remove the corresponding row from the table
                  $("#archivescompagnesTable tbody input[name='archivescompagnes']:checked").closest('tr').remove();
            
                  // Hide the modal
                  $('#confirmDeleteModal').modal('hide');
                },
                error: function(error) {
                  // Handle error
                  console.log("Deletion failed", error);
                }
              });
            }
            </script>  
         <!-- Button pour ouvrir la fenêtre de confirmation de suppression -->
         <br>
         <br>
                              <thead>
                        <tr>
                          <th></th>
                          
                          <th scope="col">Nom Annanceur</th>
                          <th scope="col">Média Vusiel</th>
                          <th data-type="date" data-format="YYYY/DD/MM">Date Publication</th>
                          <th data-type="date" data-format="YYYY/DD/MM">Date de Retrait</th>
                        </tr>
                      </thead>
                      <tbody>
                     <!-- Add more rows as needed -->
                        </tbody>
                      </table>
                      





            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  
   <!-- Footer -->
  <footer class="footer mt-5 py-3">
    <div class="copyright">
      <strong><span>Tableau De Bord</span>   <div class="social-links mt-2">
        <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
        <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
        <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
        <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
      </div></strong>
    </div>
  </footer>
  <!-- End Footer -->

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

</body>

<!-- n'integri biha men mongo -->
<script>
  async function fetchData() {
    try {
        const response = await fetch('http://localhost:3001/archivescompagnes/');
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching data:', error);
        throw error;
    }
}

async function populateTable() {
    try {
        const data = await fetchData();
        const tableBody = document.querySelector('#archivescompagnesTable tbody');

        data.forEach(function (archivescompagne) {
            var row = document.createElement('tr');
            let mediaElement = '';

            if (archivescompagne.media_vusiel) {
                if (archivescompagne.media_vusiel.endsWith('.jpg') || archivescompagne.media_vusiel.endsWith('.png')) {
                    mediaElement = `<img src="${archivescompagne.media_vusiel}" style="max-width:100px; max-height:100px;">`;
                } else if (archivescompagne.media_vusiel.endsWith('.mp4')) {
                    mediaElement = `<video controls style="max-width:100px; max-height:100px;">
                                      <source src="${archivescompagne.media_vusiel}" type="video/mp4">
                                      Your browser does not support the video tag.
                                    </video>`;
                }
            }
            row.innerHTML = `
            <td><input type="radio" name="archivescompagnes" value="${archivescompagne._id.$oid}"></td>
                <td>${archivescompagne.nom_annanceur}</td>
                <td>${mediaElement}</td>
                <td>${archivescompagne.date_publication}</td>
                <td>${archivescompagne.date_retrait}</td>
            `;
            tableBody.appendChild(row);
        });
    } catch (error) {
        console.error('Error populating table:', error);
    }
}

populateTable(); // nedi el function  populateTable() awel ma tet7al el page automatique

</script>


<!-- fonction ajouter -->
<script>
  document.getElementById('submitButton').addEventListener('click', async function(event) {
    event.preventDefault(); // Prevent the default button behavior
  
    const formData = new FormData(document.getElementById('ajouterForm')); // Create a FormData object from the form
    for (let pair of formData.entries()) {
      console.log(pair[0] + ': ' + pair[1]);
    }
    try {
      const response = await fetch('http://localhost:3001/archivescompagnes/', {
        method: 'POST',
        body: formData
      });
      
      if (response.ok) {
        const data = await response.json();
        console.log('Panneau added successfully:', data);
        window.location.href = 'ArchivesCompagnes.html';
      } else {
        console.error('Failed to add archives compagnes:', response.statusText);
      }
    } catch (error) {
      console.error('Error adding archives compagnes:', error);
    }
  });
    
    
    </script>


<!-- TELECHARGEMENT -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>

<!-- les icone pdf -->
<script>
  document.getElementById('download-pdf').addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const table = document.getElementById('archivescompagnesTable');
    const rows = Array.from(table.rows).map(row => Array.from(row.cells).map(cell => cell.innerText));

    const headers = rows.shift(); // Remove the first row for headers
    const data = rows;

    doc.autoTable({
      head: [headers],
      body: data,
    });

    doc.save('archivescompagnes.pdf');
  });
</script>
<!-- les icone Exel -->
<script>
  document.getElementById('download-excel').addEventListener('click', () => {
    const table = document.getElementById('archivescompagnesTable');
    const wb = XLSX.utils.table_to_book(table, {sheet: "archivescompagnes"});

    XLSX.writeFile(wb, 'archivescompagnes.xlsx');
  });
</script>
</html>